## Алгоритм работы системы нечеткой логики для управления климатом

## Введение

Целью данной работы было создание системы нечеткой логики, способной оценивать и управлять климатическими условиями, такими как температура и влажность, с использованием нечетких переменных и правил. Методология нечеткой логики позволяет эффективно обрабатывать неопределенности в данных, что особенно актуально в климатических системах, где условия могут быть весьма различны и варьироваться с течением времени.

### Общая схема алгоритма

Алгоритм системы нечеткой логики для управления климатом состоит из нескольких основных этапов:

1. **Сбор данных**: Считывание текущих значений температуры и влажности.
2. **Неопределенность**: Определение нечетких переменных, которые будут использоваться в правилах.
3. **Создание нечетких множеств**: Определение нечетких множеств для каждого параметра, таких как "низкая", "средняя" и "высокая" температура и влажность.
4. **Формирование правил**: Создание правил нечеткой логики, которые описывают, как система должна реагировать на различные комбинации значений.
5. **Неопределенное заключение**: Вычисление степени истинности для каждого правила на основе текущих входных данных.
6. **Агрегация выходов**: Объединение результатов всех правил для генерации общего вывода.
7. **Дефазификация**: Преобразование нечеткого результата в четкое значение, используя методы, такие как метод максимума или центроида.

### Пример работы алгоритма

Рассмотрим конкретный пример работы алгоритма:

#### Шаг 1: Сбор данных
Получаем данные о текущей температуре и влажности. Пусть текущая температура составляет 25°C, а влажность 70%.

#### Шаг 2: Определение нечетких переменных
Для температуры можно задать следующие нечеткие множества:
- Низкая (Low)
- Средняя (Medium)
- Высокая (High)

Для влажности можно задать:
- Низкая (Low)
- Средняя (Medium)
- Высокая (High)

#### Шаг 3: Создание нечетких множеств
Например, мы можем определить нечеткие множества для температуры следующим образом:

- Низкая: # температура ≤ 15
- Средняя: 15 < температура < 30
- Высокая: температура ≥ 30

А для влажности:
- Низкая: # влажность ≤ 30%
- Средняя: 30% < влажность < 70%
- Высокая: влажность ≥ 70%

#### Шаг 4: Формирование правил
Определим несколько правил, которые будут использоваться:

1. Если температура высокая и влажность высокая, то кондиционер работает на максимуме.
2. Если температура средняя и влажность средняя, то кондиционер работает на 50%.
3. Если температура низкая и влажность высокая, то кондиционер помещен в режим обогрева.

#### Шаг 5: Неопределенное заключение
На основе текущих значений (температура 25°C, влажность 70%):
- Температура оценивается как "Средняя": 0.8.
- Влажность оценивается как "Высокая": 1.0.

Применяем правила:
- Правило 1: истинность 0.0 (не выполняется).
- Правило 2: истинность 0.8 (возможно).
- Правило 3: истинность 0.0 (не выполняется).

#### Шаг 6: Агрегация выходов
Агрегируем результаты для всех применимых правил. Поскольку только правило 2 даёт ненулевую истинность, используем её для дальнейших расчетов.

#### Шаг 7: Дефазификация
Для дефазификации используем метод центроида. Если бы правило 2 указало на мощность кондиционера 50% (с функцией принадлежности), то:
\[ Output = \frac{\sum (output \times degree\_of\_truth)}{\sum degree\_of\_truth} = \frac{50 \times 0.8}{0.8} = 50 \]

Конечный результат: кондиционер должен работать на 50% своей мощности.

## Инструменты и библиотеки

Для реализации проекта были использованы следующие библиотеки:

- **NumPy**: для работы с массивами и числовыми операциями.
- **Matplotlib**: для визуализации данных и построения графиков.
- **Scipy**: для выполнения численных интеграций при расчете центроида.

Были созданы несколько основных классов, которые формируют архитектуру системы:

1. **InterpolationFunction**: для интерполяции значений на основе заданных координат.
2. **FuzzyVariable**: для создания нечетких переменных.
3. **FuzzySet**: для определения нечетких множеств.
4. **FuzzyRule**: для формирования правил нечеткой логики.

## Архитектура системы

### Структуры данных

Для реализации алгоритма используются следующие структуры данных:

1. **Структуры для нечетких переменных**: 
    - Каждая нечеткая переменная имеет определенные множества значений.
    ```python
    class FuzzyVariable:
        def __init__(self, name, terms):
            self.name = name  # Имя переменной (температура, влажность)
            self.terms = terms  # Словарь с нечеткими терминами и их функциями принадлежности
    ```

2. **Структура для правил нечеткой логики**:
    - Каждое правило описывает, как система должна действовать в зависимости от значений входных переменных.
    ```python
    class FuzzyRule:
        def __init__(self, conditions, output):
            self.conditions = conditions  # Условия, например, {температура: "Высокая", влажность: "Средняя"}
            self.output = output  # Действие, которое следует предпринять, например, "Увеличить охлаждение"
    ```

3. **Структура для системы**:
    - Основная система управляет переменными и правилами.
    ```python
    class FuzzySystem:
        def __init__(self):
            self.variables = []  # Список нечетких переменных
            self.rules = []  # Список правил
    ```

### Общая схема алгоритма

Алгоритм системы нечеткой логики для управления климатом состоит из нескольких основных этапов:

1. **Сбор данных**: Считывание текущих значений температуры и влажности.
2. **Неопределенность**: Определение нечетких переменных, которые будут использоваться в правилах.
3. **Создание нечетких множеств**: Определение нечетких множеств для каждого параметра, таких как "низкая", "средняя" и "высокая" температура и влажность.
4. **Формирование правил**: Создание правил нечеткой логики, которые описывают, как система должна реагировать на различные комбинации значений.
5. **Неопределенное заключение**: Вычисление степени истинности для каждого правила на основе текущих входных данных.
6. **Агрегация выходов**: Объединение результатов всех правил для генерации общего вывода.
7. **Дефазификация**: Преобразование нечеткого результата в четкое значение, используя методы, такие как метод максимума или центроида.

### Пример работы алгоритма

Рассмотрим конкретный пример работы алгоритма:

#### Шаг 1: Сбор данных
Получаем данные о текущей температуре и влажности. Пусть текущая температура составляет 25°C, а влажность 70%.

#### Шаг 2: Определение нечетких переменных
Для температуры можно задать следующие нечеткие множества:
- Низкая (Low)
- Средняя (Medium)
- Высокая (High)

Для влажности можно задать:
- Низкая (Low)
- Средняя (Medium)
- Высокая (High)

#### Шаг 3: Создание нечетких множеств
Например, для температурной переменной можно использовать следующие функции принадлежности:
- Для "Низкой" температуры: 
\[
\mu_{\text{Low}}(x) = 
\begin{cases} 
1 & \text{если } x \leq 15 \\
\frac{20 - x}{5} & \text{если } 15 < x < 20 \\
0 & \text{если } x \geq 20 
\end{cases}
\]
- Для "Средней" температуры:
\[
\mu_{\text{Medium}}(x) =
\begin{cases}
0 & \text{если } x \leq 20 \\
\frac{x - 20}{5} & \text{если } 20 < x < 25 \\
\frac{30 - x}{5} & \text{если } 25 \leq x < 30 \\
0 & \text{если } x \geq 30
\end{cases}
\]
- Для "Высокой" температуры:
\[
\mu_{\text{High}}(x) =
\begin{cases}
0 & \text{если } x \leq 25 \\
\frac{x - 25}{5} & \text{если } 25 < x < 30 \\
1 & \text{если } x \geq 30
\end{cases}
\]

Аналогично определяются функции принадлежности для влажности.

#### Шаг 4: Формирование правил
Правила формируются на основе значений переменных. Например:
- Если температура "Высокая" и влажность "Средняя", то "Увеличить охлаждение".
- Если температура "Низкая" и влажность "Высокая", то "Увеличить обогрев".

#### Шаг 5: Неопределенное заключение
Для текущей температуры (25°C) и влажности (70%) рассчитываем степень истинности:
- Для температуры: 
  - \(\mu_{\text{High}}(25) = 0\)
  - \(\mu_{\text{Medium}}(25) = 1\)
  - \(\mu_{\text{Low}}(25) = 0\)

- Для влажности, предположим, что 70% соответствует "Высокой": 
  - \(\mu_{\text{High}}(70) = 1\)
  - \(\mu_{\text{Medium}}(70) = 0\)
  - \(\mu_{\text{Low}}(70) = 0\)

Степень истинности правил будет 1 для правила "Если температура высокая и влажность средняя".

#### Шаг 6: Агрегация выходов
На этом этапе агрегация выходов происходит путём нахождения максимального значения принадлежности для каждого действия, основанного на степенях истинности.

#### Шаг 7: Дефазификация
Для получения четкого результата используем метод максимума или центроида. Находим четкое значение нужного действия, например, "Увеличить охлаждение".

### Заключение

Система нечеткой логики эффективна для управления климатическими условиями за счет гибкости в обработке нечетких данных и возможности принимать решения на основе набора правил. Описанный алгоритм и структуры данных представляют собой основу для разработки и реализации таких систем.

### Основные классы

#### 1. InterpolationFunction

Класс создан для интерполяции значений между заданными точками. Он позволяет вычислять значения для частных случаев (ниже минимального или выше максимального значений), а также производит линейную интерполяцию между двумя ближайшими точками.

```python
class InterpolationFunction:
    def __call__(self, x: float) -> float:
        # Логика интерполяции
```

#### 2. FuzzyVariable

Этот класс представляет нечеткую переменную и включает методы для поиска нечетких множеств по ярлыкам, визуализации нечетких множеств и присвоения значений переменной.

```python
class FuzzyVariable:
    def visualize(self, x_min: float, x_max: float, axes=plt):
        # Логика визуализации
```

#### 3. FuzzySet

Класс FuzzySet реализует методы для вычисления значений членства в нечетком множестве.

```python
class FuzzySet:
    def calculate_membership(self, value):
        # Логика вычисления членства
```

#### 4. FuzzyRule

Класс FuzzyRule определяет правила нечеткой логики, связывая входные переменные с выводами.

```python
class FuzzyRule:
    def evaluate(self, variable_name: str, value: float):
        # Логика оценки
```

### Процесс выведения

Главный алгоритм выведения, реализованный в функции `perform_inference`, оценивает входные переменные согласно заданным правилам и вычисляет новое значение на основе активированных функций.

```python
def perform_inference(variables: list[FuzzyVariable], rules=list[FuzzyRule]):
    # Логика выведения
```

## Результаты

Система была проверена с использованием наборов данных по температуре и влажности. Визуализация результатов включает графики:

1. График для влажности и температуры.
2. График для скорости вентилятора и качества воздуха.

```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))
humidity_var.visualize(0, 100, ax[0])
temperature_var.visualize(-10, 45, ax[1])
plt.show()
```

### Вычисление выходных значений

Полученные результаты позволяют вычислить центроиды (средние), которые могут быть использованы для адаптации работы климатической установки:

```python
centroid = Math().get_centroid(result, -10, 45)
print("Новое значение температуры:", centroid)
```

## Заключение

Разработанная система нечеткой логики эффективно управляет климатическими параметрами, позволяя учитывать различные входные данные и обеспечивая масштабируемость и адаптивность к изменениям условий. Это подтверждает применимость нечеткой логики для решения практических задач в области управления климатом.

Будущие работы могут быть направлены на расширение системы дополнительными переменными и правилами для более сложных сценариев.

## Литература

- Книги и статьи по теории нечеткой логики.
- Документация используемых библиотек.
- Исследования в области автоматизированного управления климатом.